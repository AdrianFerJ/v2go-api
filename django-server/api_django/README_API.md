
# Django API Readme file

## Set up Development environment

### Python, venv, and libraries

Install **pyenv** following [this instructions](https://medium.com/@Joachim8675309/installing-pythons-with-pyenv-54cca2196cd3) 

```bash
# install pipenv
$ pip install pipenv

# This would automatically install the required Python version
$ pipenv install
$ pipenv shell

# Check that packages were installed
$ (venv) pipenv graph
```

### GeoDjango Spatial libraries and Spatial-SQLlite (dev)
```bash
# GeoDjango & Libraries
$ sudo apt-get install gdal-bin libgdal-dev
$ sudo apt-get install python3-gdal
$ sudo aptitude install binutils libproj-dev


# ** IF  binutils doesn't work, try installing GEOS (C library) manually
# Continue with this instructions: https://docs.djangoproject.com/en/2.1/ref/contrib/gis/install/geolibs/
# $ wget https://download.osgeo.org/geos/geos-3.7.1.tar.bz2
# $ tar xjf geos-3.7.1.tar.bz2
# $ cd geos-3.7.1.tar.bz2
# $ ./configure
# $ make
# $ sudo make install
```


## Run API locally
1. **Activate venv** and navigate to api_django/ 

2. **Launch PostGis (db) Docker container**
# PostGres & PostGis
**IF** CONTAINER is already create, skip this and launch it with next command
```bash
# Create container
$ docker run --name=postgis_db  \
    -d -e POSTGRES_USER=dev_user \
    -e POSTGRES_PASS=SirGeorgeWilliams1515 \
    -e POSTGRES_DBNAME=pg_gis_db \
    -p 5432:5432 kartoza/postgis:9.6-2.4

# Launch container (use container ID or name)
$ docker container start /postgis_db
```

3. **Apply data models (make migrations), load start data, and run server** 
    ```bash 
    (venv)$ ./manage.py makemigrations
    (venv)$ ./manage.py migrate
    # Load user, groups, and permision fixture
    (venv)$ ./manage.py loaddata start_data/users_groups_permisions.json
    (venv)$ ./manage.py runserver
    ``` 
4. **Open Web UI generated by Django REST Framework's Brosable API**

    Open [localhost](http://127.0.0.1:8000/api/sign_up/) in your browser to talk to the API via a Web UI autogenerated by [Brosable API](https://www.django-rest-framework.org/topics/browsable-api/). Read more bellow..

## API manual testing 

Django REST Framework's [Brosable API](https://www.django-rest-framework.org/topics/browsable-api/) generates human-friendly HTML output for each resource when the HTML format is requested. These pages allow for easy browsing of resources, as well as forms for submitting data to the resources using POST, PUT, and DELETE.

### User sign up
- End point: [http://127.0.0.1:8000/api/sign_up/](http://127.0.0.1:8000/api/sign_up/).
- Input: Use automatically generated web form
- Expected output: http response(status:200)

### User Login 
- End point: [http://127.0.0.1:8000/api/log_in/](http://127.0.0.1:8000/api/log_in/)
- Input: Username and password
    ```JSON
    {
        "username": "test1",
        "password": "letmein!"
    }
    ```
- Expected output: http response(status:200) + session ID stored in browser as cookie

### User Logout 
- End point: [http://127.0.0.1:8000/api/log_in/](http://127.0.0.1:8000/api/log_in/)
- Expected output: http response(status:403) + session ID removed from browser

### Get List of CSs
- End point: [http://127.0.0.1:8000/api/volt_finder/](http://127.0.0.1:8000/api/volt_finder/)
- Input: User location. *For now input is **None***
- Expected output: http response(status:200) + list of CSs (includes an estimated distance from user to CS location)

### Other API actionss
*For more API actions*, check [volt_finder/urls.py](volt_finder/urls.py)
